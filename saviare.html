<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Formulario de Peligros</title>
</head>
<body>
    <h2>Reporte de Peligros</h2>

    <form id="testForm">
        <label>Fecha del peligro:</label>
        <input type="date" id="fechaPeligro" required><br><br>

        <label>Lugar del peligro / fase de vuelo:</label>
        <input type="text" id="lugar" required><br><br>

        <label>Base:</label>
        <input type="text" id="base" required><br><br>

        <label>Nombre:</label>
        <input type="text" id="nombre"><br><br>

        <label>Cargo:</label>
        <input type="text" id="cargo"><br><br>

        <label>Descripci√≥n del peligro / error humano:</label><br>
        <textarea id="descripcion" required></textarea><br><br>

        <label>Links de evidencia (archivos):</label>
        <input type="file" id="files" multiple><br><br>

        <button type="submit">Enviar</button>
    </form>

    <script>
        // üìå Tu enlace de Apps Script Web App
        const scriptURL = "https://script.google.com/macros/s/AKfycbyYxKo88EvsBXTEW7VkGDXmbKmRqNik_-EdzsvKWnNEwiR_ro6E-VPSSi2lvoPnCVqu/exec";

        function readFileAsBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result.split(',')[1]);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        document.getElementById("testForm").addEventListener("submit", async (e) => {
            e.preventDefault();

            const filesInput = document.getElementById("files");
            const files = [];

            for (const f of filesInput.files) {
                const base64 = await readFileAsBase64(f);
                files.push({
                    name: f.name,
                    mimeType: f.type || "application/octet-stream",
                    base64: base64
                });
            }

            const payload = {
                fechaPeligro: document.getElementById("fechaPeligro").value,
                lugar: document.getElementById("lugar").value,
                base: document.getElementById("base").value,
                nombre: document.getElementById("nombre").value,
                cargo: document.getElementById("cargo").value,
                descripcion: document.getElementById("descripcion").value,
                files: files
            };

            try {
                await fetch(scriptURL, {
                    method: "POST",
                    mode: "no-cors",
                    body: JSON.stringify(payload)
                });
                alert("‚úÖ Datos enviados correctamente");
                e.target.reset();
            } catch (err) {
                alert("‚ùå Error al enviar");
                console.error(err);
            }
        });
    </script>
</body>
</html>
