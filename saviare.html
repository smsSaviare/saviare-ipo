<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>IPO - Saviare</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body {
    font-family: Arial, sans-serif;
    background-color: #001f3f;
    color: white;
    margin: 0;
    padding: 0;
    text-align: center;
  }

  .bienvenida {
    font-size: 2em;
    margin-top: 20vh;
    white-space: nowrap;
    overflow: hidden;
    border-right: 3px solid white;
    display: inline-block;
  }

  .avion {
    width: 80px;
    vertical-align: middle;
    opacity: 0;
    transform: translateX(-50px);
    transition: all 1s ease;
  }

  form {
    max-width: 600px;
    margin: 30px auto;
    background: rgba(255,255,255,0.1);
    padding: 20px;
    border-radius: 10px;
    display: none;
  }

  input, select, textarea {
    width: 100%;
    padding: 8px;
    margin: 8px 0;
    border: none;
    border-radius: 5px;
  }

  button {
    padding: 10px 20px;
    background: #28a745;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
  }

  button:hover {
    background: #218838;
  }
</style>
</head>
<body>

<!-- Bienvenida -->
<h1 id="textoBienvenida" class="bienvenida"></h1>
<img src="Avion.png" id="avionImg" class="avion" alt="Avión">

<!-- Formulario -->
<form id="ipoForm">
  <label>Fecha del peligro:</label>
  <input type="date" name="fechaPeligro" required>

  <label>Lugar/Fase de vuelo:</label>
  <input type="text" name="lugar" required>

  <label>Base:</label>
  <input type="text" name="base" required>

  <label>Nombre:</label>
  <input type="text" name="nombre">

  <label>Cargo:</label>
  <input type="text" name="cargo">

  <label>Descripción:</label>
  <textarea name="descripcion" required></textarea>

  <label>¿Desea reportar como anónimo?</label>
  <select name="anonimo">
    <option value="false">No</option>
    <option value="true">Sí</option>
  </select>

  <label>¿Acepta los términos?</label>
  <select name="terminos" required>
    <option value="true">Sí</option>
    <option value="false">No</option>
  </select>

  <label>Subir archivo(s):</label>
  <input type="file" name="files" multiple>

  <button type="submit">Enviar</button>
</form>

<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbyYxKo88EvsBXTEW7VkGDXmbKmRqNik_-EdzsvKWnNEwiR_ro6E-VPSSi2lvoPnCVqu/exec";

// Animación bienvenida
const texto = "¡Bienvenido al sistema IPO de Saviare!";
let i = 0;
const velocidad = 70;

function escribirTexto() {
  if (i < texto.length) {
    document.getElementById("textoBienvenida").textContent += texto.charAt(i);
    i++;
    setTimeout(escribirTexto, velocidad);
  } else {
    const avion = document.getElementById("avionImg");
    avion.style.opacity = 1;
    avion.style.transform = "translateX(0)";
    setTimeout(() => {
      document.getElementById("ipoForm").style.display = "block";
      document.getElementById("textoBienvenida").style.display = "none";
      avion.style.display = "none";
    }, 2000);
  }
}
escribirTexto();

// Envío formulario
document.getElementById("ipoForm").addEventListener("submit", e => {
  e.preventDefault();
  const form = e.target;
  const data = {
    fechaPeligro: form.fechaPeligro.value,
    lugar: form.lugar.value,
    base: form.base.value,
    nombre: form.nombre.value,
    cargo: form.cargo.value,
    descripcion: form.descripcion.value,
    anonimo: form.anonimo.value === "true",
    terminos: form.terminos.value === "true",
    files: []
  };

  const files = form.files.files;
  if (files.length > 0) {
    let pending = files.length;
    for (let file of files) {
      const reader = new FileReader();
      reader.onload = function(e) {
        data.files.push({
          name: file.name,
          type: file.type,
          base64: e.target.result.split(",")[1]
        });
        pending--;
        if (pending === 0) enviarDatos(data);
      };
      reader.readAsDataURL(file);
    }
  } else {
    enviarDatos(data);
  }
});

function enviarDatos(data) {
  fetch(scriptURL, {
    method: "POST",
    body: JSON.stringify(data)
  })
  .then(res => res.text())
  .then(resp => {
    alert("Formulario enviado correctamente");
    document.getElementById("ipoForm").reset();
  })
  .catch(err => alert("Error: " + err));
}
</script>

</body>
</html>
